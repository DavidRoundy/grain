(jbuild_version 1)

(ocamllex (lexer))

(library
 ((name grain)
  (public_name grain)
  ;; Note: 'dyp' is provided by the 'dypgen' OPAM package
  (libraries   (oUnit extlib batteries cmdliner ocamlgraph wasm stdint dyp))))

(rule
 ((targets (parser.ml))
  (deps (parser.dyp))
  (action (run dypgen --no-mli --Werror --pv-obj ${<}))))

(executable
 ((name grainc)
  (public_name grainc)
  (package grain)
  (libraries (grain))))

(install
 ((section lib)
  (files ((grain-stdlib/lists.grlib as stdlib/lists.grlib)))
  (package grain)))
